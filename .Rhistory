for(r in 1:4){
temp <- subset(growPar, Sex == c("F","M")[s] & Region == paste0("R",c(1,2,4,5)[r]))
if("pool" %in% temp$Period){
Linf_yk[,r,s] <- temp$Linf
next()
}
Linf_yk[1:2009-1960,r,s] <- temp$Linf[temp$Period == 'early']
Linf_yk[(2009-1966):nrow(Linf_yk),r,s] <- temp$Linf[temp$Period == 'late']
}
}
for(s in 1:2){
for(r in 1:4){
temp <- subset(growPar, Sex == c("F","M")[s] & Region == paste0("R",c(1,2,4,5)[r]))
if("pool" %in% temp$Period){
Linf_yk[,r,s] <- temp$Linf
next()
}
Linf_yk[1:2009-1960,r,s] <- temp$Linf[temp$Period == 'early']
Linf_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$Linf[temp$Period == 'late']
}
}
for(s in 1:2){
for(r in 1:4){
temp <- subset(growPar, Sex == c("F","M")[s] & Region == paste0("R",c(1,2,4,5)[r]))
if("pool" %in% temp$Period){
Linf_yk[,r,s] <- temp$Linf
next()
}
Linf_yk[1:(2009-1960),r,s] <- temp$Linf[temp$Period == 'early']
Linf_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$Linf[temp$Period == 'late']
}
}
Linf_yk
temp
# array of year x stock x sex
Linf_yk <- L1_yk <- kappa_yk <- sigmaG_yk <- array(NA,
dim = c(length(1960:2018),
length(unique(growPar$Region)),2))
for(s in 1:2){
for(r in 1:4){
temp <- subset(growPar, Sex == c("F","M")[s] & Region == paste0("R",c(1,2,4,5)[r]))
if("pool" %in% temp$Period){
Linf_yk[,r,s] <- temp$Linf
L1_yk[,r,s] <- temp$L1
kappa_yk[,r,s] <- temp$k
sigmaG_yk[,r,s] <- temp$Sigma
next()
}
Linf_yk[1:(2009-1960),r,s] <- temp$Linf[temp$Period == 'early']
Linf_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$Linf[temp$Period == 'late']
L1_yk[1:(2009-1960),r,s] <- temp$L1[temp$Period == 'early']
L1_yk[(2009-1960):nrow(L1_yk),r,s] <- temp$L1[temp$Period == 'late']
sigmaG_yk[1:(2009-1960),r,s] <- temp$K[temp$Period == 'early']
sigmaG_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$K[temp$Period == 'late']
sigmaG_yk[1:(2009-1960),r,s] <- temp$Sigma[temp$Period == 'early']
sigmaG_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$Sigma[temp$Period == 'late']
}
}
for(s in 1:2){
for(r in 1:4){
temp <- subset(growPar, Sex == c("F","M")[s] & Region == paste0("R",c(1,2,4,5)[r]))
if("pool" %in% temp$Period){
Linf_yk[,r,s] <- temp$Linf
L1_yk[,r,s] <- temp$L1
kappa_yk[,r,s] <- temp$k
sigmaG_yk[,r,s] <- temp$Sigma
next()
}
Linf_yk[1:(2009-1960),r,s] <- temp$Linf[temp$Period == 'early']
Linf_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$Linf[temp$Period == 'late']
L1_yk[1:(2009-1960),r,s] <- temp$L1[temp$Period == 'early']
L1_yk[(2009-1960):nrow(L1_yk),r,s] <- temp$L1[temp$Period == 'late']
sigmaG_yk[1:(2009-1960),r,s] <- temp$k[temp$Period == 'early']
sigmaG_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$k[temp$Period == 'late']
sigmaG_yk[1:(2009-1960),r,s] <- temp$Sigma[temp$Period == 'early']
sigmaG_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$Sigma[temp$Period == 'late']
}
}
sigmaG_yk
for(s in 1:2){
for(r in 1:4){
temp <- subset(growPar, Sex == c("F","M")[s] & Region == paste0("R",c(1,2,4,5)[r]))
if("pool" %in% temp$Period){
Linf_yk[,r,s] <- temp$Linf
L1_yk[,r,s] <- temp$L1
kappa_yk[,r,s] <- temp$k
sigmaG_yk[,r,s] <- temp$Sigma
next()
}
Linf_yk[1:(2009-1960),r,s] <- temp$Linf[temp$Period == 'early']
Linf_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$Linf[temp$Period == 'late']
L1_yk[1:(2009-1960),r,s] <- temp$L1[temp$Period == 'early']
L1_yk[(2009-1960):nrow(L1_yk),r,s] <- temp$L1[temp$Period == 'late']
kappa_yk[1:(2009-1960),r,s] <- temp$k[temp$Period == 'early']
kappa_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$k[temp$Period == 'late']
sigmaG_yk[1:(2009-1960),r,s] <- temp$Sigma[temp$Period == 'early']
sigmaG_yk[(2009-1960):nrow(Linf_yk),r,s] <- temp$Sigma[temp$Period == 'late']
}
}
sigmaG_yk
kappa_yk
log(19)
log(95/100)
exo(-.0.05)
exo(-0.05)
exp(-0.05)
20*75
## maturity ----
## Ben sent me wiggly curves and p25/50/75 values for FEMALES for the defined regions
## note that we use log15 for the 75%ile
logistic <- function(age, a50, a75){
selage <- 1/(1+exp(-(log(15))*(age-a50)/(a75-a50)))
return(selage)
}
matPar <- data.frame('region' = paste0('R',1:4),
'a50' = c(8.3,4.5,4.6,6.8),
'a75' = c(8.7,5.1,4.97,7.7))
matPar
mat_ak <- matrix(NA, nrow = nage, ncol = 4)
for(a in 1:nrow(mat_ak)){
for(k in 1:nrow(matPar)){
mat_ak[a,k] <- logistic(age = a, a50 = matPar$a50[k], a75 = matPar$a75[k])
}
}
mat_ak
mat_ak %>%
mutate(age = 1:nage) %>%
melt(id = 'age') %>%
ggplot(., aes(x = age, y = value, color = variable)) %>%
geom_line(lwd = 1.1)
names(mat_ak) <- paste0('R',1:4)
mat_ak %>%
data.frame() %>%
mutate(age = 1:nage) %>%
melt(id = 'age') %>%
ggplot(., aes(x = age, y = value, color = variable)) %>%
geom_line(lwd = 1.1)
mat_ak %>%
data.frame() %>%
mutate(age = 1:nage) %>%
melt(id = 'age') %>%
ggplot(., aes(x = age, y = value, color = variable)) +
geom_line(lwd = 1.1)
mat_ak %>%
data.frame() %>%
mutate(age = 1:nage) %>%
melt(id = 'age')
mat_ak
for(a in 1:nrow(mat_ak)){
for(k in 1:nrow(matPar)){
mat_ak[a,k] <- logistic(age = a, a50 = matPar$a50[k], a75 = matPar$a75[k])
}
}
names(mat_ak) <- paste0('R',1:4)
mat_ak
mat_ak %>%
data.frame() %>%
mutate(age = 1:nage) %>%
melt(id = 'age') %>%
ggplot(., aes(x = age, y = value, color = variable)) +
geom_line(lwd = 1.1) +
theme_sleek() +theme(legend.position = c(0.9,0.8)) +
labs(x = 'Age', y = 'Proportion Mature', color = 'Stock')
save(list(Linf_yk, L1_yk,kappa_yk, sigmaG_yk), file = here('input','input_data',"OM_growthPars.rdata"))
list(Linf_yk, L1_yk,kappa_yk, sigmaG_yk)
save(list(Linf_yk, L1_yk,kappa_yk, sigmaG_yk),
file = here('input','input_data',"OM_growthPars.rdata"))
omgp <- list(Linf_yk, L1_yk,kappa_yk, sigmaG_yk)
save(omgp,
file = here('input','input_data',"OM_growthPars.rdata"))
save(mat_ak, file =  here('input','input_data',"OM_maturity_ak.rdata"))
mat_ak %>%
data.frame() %>%
mutate(age = 1:nage) %>%
melt(id = 'age') %>%
ggplot(., aes(x = age, y = value, color = variable)) +
geom_line(lwd = 1.1) +
scale_color_brewer(palette = 'Dark2', labels =  paste0('R',1:4)) +
theme_sleek() +theme(legend.position = c(0.9,0.8)) +
labs(x = 'Age', y = 'Proportion Mature', color = 'Stock')
ggsave(last_plot(),
file = here('input','input_data','input_figs','om_maturity'),
height = 6, width = 6, unit = 'in', dpi = 420)
ggsave(last_plot(),
file = here('input','input_data','input_figs','om_maturity.png'),
height = 6, width = 6, unit = 'in', dpi = 420)
mat_ak %>%
data.frame() %>%
mutate(age = 1:nage) %>%
melt(id = 'age') %>%
ggplot(., aes(x = age, y = value, color = variable)) +
geom_line(lwd = 1.1) +
scale_color_manual(values = demPal, labels =  paste0('R',1:4)) +
theme_sleek() +theme(legend.position = c(0.9,0.8)) +
labs(x = 'Age', y = 'Proportion Mature', color = 'Stock')
demPal <- c('pink','dodgerblue','dodgerblue','goldenrod','goldenrod','grey22') ## 4 demographic regions
mat_ak %>%
data.frame() %>%
mutate(age = 1:nage) %>%
melt(id = 'age') %>%
ggplot(., aes(x = age, y = value, color = variable)) +
geom_line(lwd = 1.1) +
scale_color_manual(values = demPal, labels =  paste0('R',1:4)) +
theme_sleek() +theme(legend.position = c(0.9,0.8)) +
labs(x = 'Age', y = 'Proportion Mature', color = 'Stock')
demPal <- c('pink','dodgerblue','goldenrod','grey22') ## 4 demographic regions
mat_ak %>%
data.frame() %>%
mutate(age = 1:nage) %>%
melt(id = 'age') %>%
ggplot(., aes(x = age, y = value, color = variable)) +
geom_line(lwd = 1.1) +
scale_color_manual(values = rev(demPal), labels =  paste0('R',1:4)) +
theme_sleek() +theme(legend.position = c(0.9,0.8)) +
labs(x = 'Age', y = 'Proportion Mature', color = 'Stock')
ggsave(last_plot(),
file = here('input','input_data','input_figs','om_maturity.png'),
height = 6, width = 6, unit = 'in', dpi = 420)
## wc selex
wc$SelAgeAdj
wc$ageselex
head(wc$sizeselex)
## wc selex (age only)
wc$ageselex
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1)
?pivot_longer
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
melt(id = c('Yr','Fleet'))
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
melt(id = c('Yr','Fleet')) %>% head()
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>% head()
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_longer(., cols = Fleet) %>%
head()
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_longer(., cols = Fleet, names_sep = "_") %>%
head()
?pivot_wider
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(., names_from = Fleet) %>%
head()
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(., names_from = Fleet, values_from = value) %>%
head()
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(., id_cols = c(Yr,variable), names_from = Fleet, values_from = value) %>%
head()
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(., id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value,
values_fill = NA) %>%
head()
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
# id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value,
values_fill = NA) %>%
head()
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
# id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value) %>%
head()
fltnames
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
# id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value) %>%
View()
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet'))
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1)
wc$ageselex %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet'))
wc$ageselex %>%
filter(Yr > 1959) %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet'))
wc$ageselex %>%
filter(Yr > 1959) %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>% View()
head(wc$ageselex)
head(subset(wc$ageselex, Sex == 1)
)
View(subset(wc$ageselex, Sex == 1))
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet'))
## wc selex (age only); in SS 1 = FEM
wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value) %>%
View()
fltnames$NAME[fltnames$M == 'WC']
wc$FleetNames
names(wc_fem_asel)[2:9]
## wc selex (age only); in SS 1 = FEM
wc_fem_asel <- wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value)
names(wc_fem_asel)[2:9]
names(wc_fem_asel)[2:9] <- c('age',wc$FleetNames)
wc$FleetNames
## wc selex (age only); in SS 1 = FEM
wc_fem_asel <- wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value)
head(wc_fem_asel)
names(wc_fem_asel)
names(wc_fem_asel)[2:9]
names(wc_fem_asel)[2:10] <- c('age',wc$FleetNames)
fltnames$NAME
wc_fem_asel
fltnames$NAME[fltnames$M == 'WC']
fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)]
names(wc_fem_asel)[c(3,4,10)] <- fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)]
wc_fem_asel
names(wc_fem_asel)[c(3,4,10)] <- paste(fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)])
wc_fem_asel
names(wc_fem_asel)[2:10] <- c('age',wc$FleetNames) ## names from assessment
names(wc_fem_asel)
names(wc_fem_asel)[c(3,5,10)] <- paste(fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)])
wc_fem_asel
wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value)
wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value) %>%
select(-`2`)
## wc selex (age only); in SS 1 = FEM
wc_fem_asel <- wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value) %>%
select(Yr, variable,`1`,`4`,`8`) ## FIX, TWL, NWCBO
wc$FleetNames[c(1,4,8)]
wc$FleetNames
## wc selex (age only); in SS 1 = FEM
wc_fem_asel <- wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value) %>%
select(Yr, variable,`1`,`4`,`8`) ## FIX, TWL, NWCBO
names(wc_fem_asel)
fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)
)
fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)]
# names(wc_fem_asel)[2:5] <- c('age',wc$FleetNames[c(1,3,8)]) ## names from assessment
names(wc_fem_asel)[c(2:5)] <- c('age',paste(fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)])) ## names from OM
wc_fem_asel
wc_mal_asel <- wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 2) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet')) %>%
pivot_wider(.,
id_cols = c(Yr,variable),
names_from = Fleet,
values_from = value) %>%
select(Yr, variable,`1`,`4`,`8`) ## FIX, TWL, NWCBO
names(wc_fem_asel)[c(2:5)] <-names(wc_mal_asel)[c(2:5)] <- c('age',paste(fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)])) ## names from OM
wc_mal_asel
names(wc_fem_asel) <-names(wc_mal_asel)<- c('Year','age',paste(fltnames$NAME[fltnames$M == 'WC'][c(2,3,1)])) ## names from OM
wc_mal_asel
fltnames[fltnames$M == 'AK']
fltnames[fltnames$M == 'AK',]
## ak aselex
logistic2 <- function(age, a50, delta){
selage <- 1/(1+exp(-delta*(age-a50)))
return(selage)
}
wc_fem_asel
wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex) %>%
melt(id = c('Yr','Fleet'))
wc$ageselex %>%
filter(Yr > 1959 & Factor == 'Asel') %>%
select(-Factor, -Seas, -Morph,-Label) %>%
filter(Sex == 1) %>%
select(-Sex)
95/5
