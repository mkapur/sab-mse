## if not in this block, skip
if(is.na(srv_sel_afsb[1,flt,1,blk])) next()
## if fixed overwrite colors
if(is.na(map_srvslx[flt,1,blk,1])){
sexPal_temp = c('grey22','grey66')
} else{
sexPal_temp = sexPal
}
for(s in 1:2){
tmp <- srv_sel_afsb[,flt,s,blk]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2], type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
}
for(flt in 1:length(df$selType_surv)){
## if not in this block, skip
if(is.na(srv_sel_afsb[1,flt,1,blk])) next()
## if fixed overwrite colors
if(is.na(map_srvslx[flt,1,blk,1])){
sexPal_temp = c('grey22','grey66')
} else{
sexPal_temp = sexPal
}
for(s in 1:2){
tmp <- srv_sel_afsb[,flt,s,blk]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = survfltPal[flt])
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2],
type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
}
survfltPal
for(flt in 1:length(df$selType_surv)){
## if not in this block, skip
if(is.na(srv_sel_afsb[1,flt,1,blk])) next()
## if fixed overwrite colors
if(is.na(map_srvslx[flt,1,blk,1])){
sexPal_temp = c('grey22','grey66')
} else{
sexPal_temp = sexPal
}
for(s in 1:2){
tmp <- srv_sel_afsb[,flt,s,blk]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = c(survfltPal[flt],rep('black',4)))
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2],
type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
}
for(s in 1:2){
tmp <- srv_sel_afsb[,flt,s,blk]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = c(survfltPal[flt],rep('black',1)))
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2],
type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
?text
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=3, y = 0.8, label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,1,blk,s],"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,2,blk,s]))
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2],
type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
}
dev.off()
} ## end blks
} else{ ## all were fixed
inputSel <- selP <- array(exp(df$parms$log_srv_slx_pars), dim = c(df$nfleets_surv+df$nfleets_acomp-(df$nsurvflts_acomp+df$nfishflts_acomp),2,
max(df$srv_blks_size),2),
dimnames = dimnames(df$parms$log_srv_slx_pars))
# array(exp(best[grep('log_srv_slx_pars',names(best))]),
#                         dim = c(df$nfleets_surv+df$nfleets_acomp-4,2,max(df$srv_blks_size),2),
#                         dimnames = dimnames(df$parms$log_srv_slx_pars))
srv_sel_afs <- array(NA, dim =  c(df$nage,length(df$selType_surv),2),
dimnames = list(c(df$age),
c(dimnames(df$parms$log_srv_slx_pars)[[1]]),
c('Fem','Mal')))
for(s in 1:2){
for(surv_flt in 1:length(df$selType_surv)){
srv_sel_afs[,surv_flt,s] <- getSelec2(sex = s,
selP = selP,
flt_idx = surv_flt,
selType = df$selType_surv[surv_flt],
selShape = df$selShape_surv[surv_flt],
fltType = 'surv')
} ## end surv fleet
} ## end sex
png(paste0(dumpfile,'/survey_selex.png'),
height = 8, width = 6, unit = 'in', res = 420)
par(mfrow = c(4,2) )
sexPal_temp = c('grey22','grey66')
for(flt in 1:length(df$selType_surv)){
for(s in 1:2){
tmp <- srv_sel_afs[,flt,s]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = dimnames(df$parms$log_srv_slx_pars)[[1]][flt], xlim = c(0,75),
col.main  = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
box(which = 'plot', lty = 'solid',
col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2], type = 'l', lty = 2, lwd = 2)
}
}
dev.off()
} ## end if all fixed
} ## end func
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=3, y = 0.8, label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,1,blk,s],"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,2,blk,s])))
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = c(survfltPal,rep('black',1))[flt])
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=3, y = 0.8, label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,1,blk,s],"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,2,blk,s])))
dev.off()
for(flt in 1:length(df$selType_surv)){
## if not in this block, skip
if(is.na(srv_sel_afsb[1,flt,1,blk])) next()
## if fixed overwrite colors
if(is.na(map_srvslx[flt,1,blk,1])){
sexPal_temp = c('grey22','grey66')
} else{
sexPal_temp = sexPal
}
for(s in 1:2){
tmp <- srv_sel_afsb[,flt,s,blk]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = c(survfltPal,rep('black',1))[flt])
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=3, y = 0.8, label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,1,blk,s],"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,2,blk,s])))
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2],
type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
}
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=3, y = 0.8, cex = 2,label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,1,blk,s],"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"95=", selP[flt,2,blk,s])))
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=3, y = 0.8, cex = 1.1,label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,1,blk,s],"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"95=", selP[flt,2,blk,s])))
par(mfrow = c(4,2) )
for(flt in 1:length(df$selType_surv)){
## if not in this block, skip
if(is.na(srv_sel_afsb[1,flt,1,blk])) next()
## if fixed overwrite colors
if(is.na(map_srvslx[flt,1,blk,1])){
sexPal_temp = c('grey22','grey66')
} else{
sexPal_temp = sexPal
}
for(s in 1:2){
tmp <- srv_sel_afsb[,flt,s,blk]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = c(survfltPal,rep('black',1))[flt])
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=3, y = 0.8, cex = 1.1,label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=", selP[flt,1,blk,s],"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"95=", selP[flt,2,blk,s])))
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2],
type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
}
par(mfrow = c(4,2) )
for(flt in 1:length(df$selType_surv)){
## if not in this block, skip
if(is.na(srv_sel_afsb[1,flt,1,blk])) next()
## if fixed overwrite colors
if(is.na(map_srvslx[flt,1,blk,1])){
sexPal_temp = c('grey22','grey66')
} else{
sexPal_temp = sexPal
}
for(s in 1:2){
tmp <- srv_sel_afsb[,flt,s,blk]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = c(survfltPal,rep('black',1))[flt])
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=3, y = 0.8, cex = 1.1,label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=",
round(selP[flt,1,blk,s],1),"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"95=",
round(selP[flt,2,blk,s],2))))
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2],
type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
}
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=60, y = 0.8, cex = 1.1,label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=",
round(selP[flt,1,blk,s],1),"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"95=",
round(selP[flt,2,blk,s],2))))
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=60, y = 0.2, cex = 1.1,label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=",
round(selP[flt,1,blk,s],1),"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"95=",
round(selP[flt,2,blk,s],2))))
for(flt in 1:length(df$selType_surv)){
## if not in this block, skip
if(is.na(srv_sel_afsb[1,flt,1,blk])) next()
## if fixed overwrite colors
if(is.na(map_srvslx[flt,1,blk,1])){
sexPal_temp = c('grey22','grey66')
} else{
sexPal_temp = sexPal
}
for(s in 1:2){
tmp <- srv_sel_afsb[,flt,s,blk]
if(s == 1) plot(tmp,
col = sexPal_temp[1],
type = 'l',
lwd = 2,
xlab = ifelse(df$selType_surv[flt] == 0,
'Age','Length'),
ylab = 'Selectivity',
lty = 1,
ylim = c(0,1),
main = paste0(dimnames(df$parms$log_srv_slx_pars)[[1]][flt],
" ", df$srv_blks[blk,flt]+1960),
xlim = c(0,75),
col.main  = c(survfltPal,rep('black',1))[flt])
# c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt])
text(x=60, y = 0.2, cex = 1.1,label =
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"50=",
round(selP[flt,1,blk,s],1),"\n",
paste0(ifelse(df$selType_surv[flt] == 0,
'A','L'),"95=",
round(selP[flt,2,blk,s],2))))
box(which = 'plot', lty = 'solid',
col = survfltPal[flt],
# col = c(rep(mgmtPal[1],4), rep(mgmtPal[2],3),rep(mgmtPal[3],2))[flt],
lwd = 2)
if(s == 2) lines(tmp, col = sexPal_temp[2],
type = 'l', lty = 2, lwd = 2)
# seeddim = nestflts
# lines(bounds$lower type = 'v', col = sexPal[2])
}
}
## age comps  ----
OM_agecomps_yafs <- array(NA, dim = c(length(1960:2019),
length(0:70),
length(fltnames$NAME[fltnames$ACOMP]),2),
dimnames = list(c(1960:2019),
c(0:70),
c(fltnames$NAME[fltnames$ACOMP]),
c('Fem','Mal')))
## per fleet and sex, designate which bin acomps start/stop at for looping purposes
acomp_dims_yfs <- array(NA, dim = c(60,2,8,2)) ## years, stary&stop, fleet, sex
for(y in 1:60){
for(flt in 1:8){
for(s in 1:2){
acomp_dims_yfs[y,1,flt,s] <- first(which(is.na(OM_agecomps_yafs[y,,flt,s])))
acomp_dims_yfs[y,2,flt,s] <- last(which(is.na(OM_agecomps_yafs[y,,flt,s])))
}
}
}
df$nfleets_acomp
for(y in 1:df$nyear){
for(flt in 1:df$nfleets_acomp){
for(s in 1:2){
acomp_dims_yfs[y,1,flt,s] <- first(which(is.na(OM_agecomps_yafs[y,,flt,s])))
acomp_dims_yfs[y,2,flt,s] <- last(which(is.na(OM_agecomps_yafs[y,,flt,s])))
}
}
}
acomp_dims_yfs
## per fleet and sex, designate which bin acomps start/stop at for looping purposes
acomp_dims_yfs <- array(NA,
dim = c(60,2,df$nfleets_acomp,2),
dimnames = list(c(1960:2019),
c('miny','maxy'),
df$fltnames_acomp,
c('fem','mal'))) ## years, stary&stop, fleet, sex
## per fleet and sex, designate which bin acomps start/stop at for looping purposes
acomp_dims_yfs <- array(NA,
dim = c(60,2,df$nfleets_acomp,2),
dimnames = list(c(1960:2019),
c('miny','maxy'),
c(df$fltnames_acomp),
c('fem','mal'))) ## years, stary&stop, fleet, sex
df$nfleets_acomp
df$fltnames_acomp
## per fleet and sex, designate which bin acomps start/stop at for looping purposes
acomp_dims_yfs <- array(NA,
dim = c(60,2,df$nfleets_acomp,2),
dimnames = list(c(1960:2019),
c('miny','maxy'),
c(unlist(df$fltnames_acomp)),
c('fem','mal'))) ## years, stary&stop, fleet, sex
acomp_dims_yfs
c(unlist(df$fltnames_acomp))
c(as.character(unlist(df$fltnames_acomp)))
## per fleet and sex, designate which bin acomps start/stop at for looping purposes
acomp_dims_yfs <- array(NA,
dim = c(60,2,df$nfleets_acomp,2),
dimnames = list(c(1960:2019),
c('miny','maxy'),
c(as.character(unlist(df$fltnames_acomp))),
c('fem','mal'))) ## years, stary&stop, fleet, sex
acomp_dims_yfs
c(as.character(unlist(df$fltnames_acomp)))
for(y in 1:df$nyear){
for(flt in 1:df$nfleets_acomp){
for(s in 1:2){
acomp_dims_yfs[y,1,flt,s] <- first(which(is.na(OM_agecomps_yafs[y,,flt,s])))
acomp_dims_yfs[y,2,flt,s] <- last(which(is.na(OM_agecomps_yafs[y,,flt,s])))
}
}
}
acomp_dims_yfs
for(y in 1:df$nyear){
for(flt in 1:df$nfleets_acomp){
for(s in 1:2){
acomp_dims_yfs[y,1,flt,s] <- first(which(!is.na(OM_agecomps_yafs[y,,flt,s])))
acomp_dims_yfs[y,2,flt,s] <- last(which(!is.na(OM_agecomps_yafs[y,,flt,s])))
}
}
}
acomp_dims_yfs
## per fleet and sex, designate which bin acomps start/stop at for looping purposes
acomp_dims_yfs <- array(NA,
dim = c(60,2,df$nfleets_acomp,2),
dimnames = list(c(1960:2019),
c('abinlo','abinhi'),
c(as.character(unlist(df$fltnames_acomp))),
c('fem','mal'))) ## years, stary&stop, fleet, sex
for(y in 1:df$nyear){
for(flt in 1:df$nfleets_acomp){
for(s in 1:2){
acomp_dims_yfs[y,1,flt,s] <- first(which(!is.na(OM_agecomps_yafs[y,,flt,s])))
acomp_dims_yfs[y,2,flt,s] <- last(which(!is.na(OM_agecomps_yafs[y,,flt,s])))
}
}
}
acomp_dims_yfs
