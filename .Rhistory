dat$R_yi[1:15,]
steep <- exp(opt$par[1:4])
names(steep) <- paste0("h","_R",4:1)
steep
logR_0 <- opt$par[5:8]
names(logR_0) <- paste0("logR_0","_R",4:1)
logR_0
dat$R_yk[1:15,]
opt$par
dat$tildeR_yk
dat$SSB_0i
dat$SSB_0k
dat$N_0ais
load("C:/Users/mkapur/Dropbox/UW/sab-mse/output/2020-10-15-ltop15yv2L/dfUSED.rdata")
df$mat_age
dat$Ninit_ais[,,1] %>%
data.frame() %>%
mutate('Age' = age) %>%
reshape2::melt(id = c('Age')) %>%
ggplot(., aes(x = Age, y = value, color = variable )) +
scale_color_manual(values = subareaPal) +
geom_line(lwd = 2) +
labs(x = 'Age in Initial Years',y = 'Initial Numbers', color = 'subarea') +
ggsidekick::theme_sleek()+
facet_wrap(~variable,scales = 'free_y')
sum(  dat$Ninit_ais<0)
sum(dat$N_0ais <0)
dat$N_0ais
## NA0 & SB0 ----
## note that omega makes this non-smooth
N_0ais <- array(0, dim = c(nage, nspace, 2), dimnames = list(c(age),c(inames),c('Fem','Mal')))
phi_ik2
attach_df
attach(df)
for(s in 1:2){ ## 1 is female, 2 is male
# for(k in 1:nstocks){
for(i in 1:nspace){
for(a in 1:(nage-1)){
N_0ais[a,i,s] = N_0ais[a,i,s]+
0.5*
# omega_ais[a,i,s]*
R_0k[phi_ik2[i]]*
tau_ki[phi_ik2[i],i]* ## downscale to subarea. C1 and A1 higher because they're own stock
exp(-(mat_age[a]*age[a])) ## same as sum to age
# cat(paste(c(s,k,i,a), sep = " "),     N_0ais[a,i,s] ,"\n")
} ## end age < plus
# // note the A+ group will be in slot A-1
N_0ais[nage,i,s] =
N_0ais[nage,i,s] +
# omega_ais[a,i,s]*
(N_0ais[nage-1,i,s]*
exp(-sum(mat_age)))/
(1-exp(-mat_age[nage]))
} ## // end subareas
# }  ## // end stocks
} ## end sexes
## NA0 & SB0 ----
## note that omega makes this non-smooth
N_0ais <- array(0, dim = c(nage, nspace, 2), dimnames = list(c(age),c(inames),c('Fem','Mal')))
for(s in 1:2){ ## 1 is female, 2 is male
# for(k in 1:nstocks){
for(i in 1:nspace){
for(a in 1:(nage-1)){
N_0ais[a,i,s] = N_0ais[a,i,s]+
0.5*
# omega_ais[a,i,s]*
R_0k[phi_ik2[i]]*
tau_ki[phi_ik2[i],i]* ## downscale to subarea. C1 and A1 higher because they're own stock
exp(-(mat_age[a]*age[a])) ## same as sum to age
# cat(paste(c(s,k,i,a), sep = " "),     N_0ais[a,i,s] ,"\n")
} ## end age < plus
# // note the A+ group will be in slot A-1
N_0ais[nage,i,s] =
N_0ais[nage,i,s] +
# omega_ais[a,i,s]*
(N_0ais[nage-1,i,s]*
exp(-sum(mat_age)))/
(1-exp(-mat_age[nage]))
} ## // end subareas
# }  ## // end stocks
} ## end sexes
R_0k
df$ro
R_0k = exp(df$parms$logR_0k)
for(s in 1:2){ ## 1 is female, 2 is male
# for(k in 1:nstocks){
for(i in 1:nspace){
for(a in 1:(nage-1)){
N_0ais[a,i,s] = N_0ais[a,i,s]+
0.5*
# omega_ais[a,i,s]*
R_0k[phi_ik2[i]]*
tau_ki[phi_ik2[i],i]* ## downscale to subarea. C1 and A1 higher because they're own stock
exp(-(mat_age[a]*age[a])) ## same as sum to age
# cat(paste(c(s,k,i,a), sep = " "),     N_0ais[a,i,s] ,"\n")
} ## end age < plus
# // note the A+ group will be in slot A-1
N_0ais[nage,i,s] =
N_0ais[nage,i,s] +
# omega_ais[a,i,s]*
(N_0ais[nage-1,i,s]*
exp(-sum(mat_age)))/
(1-exp(-mat_age[nage]))
} ## // end subareas
# }  ## // end stocks
} ## end sexes
## NA0 & SB0 ----
## note that omega makes this non-smooth
N_0ais <- array(0, dim = c(nage, nspace, 2), dimnames = list(c(age),c(inames),c('Fem','Mal')))
R_0k
phi_ik2
phi_ik2 = phi_ik2+1
## NA0 & SB0 ----
## note that omega makes this non-smooth
N_0ais <- array(0, dim = c(nage, nspace, 2), dimnames = list(c(age),c(inames),c('Fem','Mal')))
for(s in 1:2){ ## 1 is female, 2 is male
# for(k in 1:nstocks){
for(i in 1:nspace){
for(a in 1:(nage-1)){
N_0ais[a,i,s] = N_0ais[a,i,s]+
0.5*
# omega_ais[a,i,s]*
R_0k[phi_ik2[i]]*
tau_ki[phi_ik2[i],i]* ## downscale to subarea. C1 and A1 higher because they're own stock
exp(-(mat_age[a]*age[a])) ## same as sum to age
# cat(paste(c(s,k,i,a), sep = " "),     N_0ais[a,i,s] ,"\n")
} ## end age < plus
# // note the A+ group will be in slot A-1
N_0ais[nage,i,s] =
N_0ais[nage,i,s] +
# omega_ais[a,i,s]*
(N_0ais[nage-1,i,s]*
exp(-sum(mat_age)))/
(1-exp(-mat_age[nage]))
} ## // end subareas
# }  ## // end stocks
} ## end sexes
N_0ais
tau_ki
phi_ik2[3]
N_0ais %>% colSums
opt$par
best = opt$par
array(exp(best[names(best)=='log_fsh_slx_pars']), dim = c(9,2,2))
opt$max_gradient
length(best[names(best)=='log_fsh_slx_pars'])
array(1:36, dim = c(9,2,2))
array(exp(lower[names(lower)=='log_fsh_slx_pars']), dim = c(9,2,2))
# rep1$N_yais_beg[1:7,c(0:4,71),,1]
# rep1$N_yais_mid[1:7,c(0:4,71),,1]
# rep1$N_yais_end[1:7,c(0:4,71),,1]
# likes <- rep1$ans_tot %>% matrix(., ncol = length(.)) %>% data.frame()
# names(likes) = c("SDR","CATCH","SURVEY","SURVCOMP","CATCHCOMP","PRIORS")
# likes
source(here('R','functions','boundPars.R')) ## bound selex etc
array(exp(lower[names(lower)=='log_fsh_slx_pars']), dim = c(9,2,2))
array(exp(best[names(best)=='log_fsh_slx_pars']), dim = c(9,2,2))
H_K
## Kapur M
library(sf)
library(here)
library(tibble)
require(ggplot2)
require(dplyr)
require(patchwork)
require(ggsidekick)
require(rgdal)
library(marmap)
#
load(here('input','downloads','eez_nepac_regions.rda'))
regions <- eez_nepac_regions
## orthogonal clips
load(here('input','downloads',"sub_area_clips_B1.Rdata")) ## default clips for original 7 areas
## 50N flat clips
load(here('input','downloads',"sub_area_clips_50N.Rdata") )
load(here("input","downloads","n36_shape.rda"))
load(here("input","downloads","n50_shape.rda"))
load(here('input','downloads',"sub_area_clips_B2.Rdata")) ## default clips for original 7 areas
ggplot(data = regions) +
# kaplot::theme_solarized_mk(base_size = 16, light = FALSE) +
theme_classic(base_size = 14) +
## mgmt fills
# geom_sf(data = clips[[1]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = mgmtPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = mgmtPal[2], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = mgmtPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = mgmtPal[3], alpha = 0.9,color = NA) +
## show demography from growth paper
##R3
# geom_sf(data =   st_union(x=clips[[2]],y=clips[[3]])  ,
# fill = NA, lwd = 1.1,color = 'white', linetype = 'dashed') +
# ##r2
# geom_sf(data =   st_union(x=clips[[4]],y=clips[[5]])  ,
# fill = NA, lwd = 1.1,  color = 'white', linetype = 'dashed') +
## subarea fills
# geom_sf(data = clips[[1]], fill = subareaPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = subareaPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = subareaPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = subareaPal[4], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = subareaPal[5], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = subareaPal[6], alpha = 0.9,color = NA) +
## stock fills
geom_sf(data = clips[[1]], fill = demPal[1], alpha = 0.9, color = NA) +
geom_sf(data =  clips[[2]], fill = demPal[2], alpha = 0.9, color = NA) +
geom_sf(data = clips[[3]], fill = demPal[2], alpha = 0.9, color = NA) +
geom_sf(data = clips[[4]], fill = demPal[3], alpha = 0.9, color = NA ) +
geom_sf(data = clips[[5]], fill = demPal[3], alpha = 0.9, color = NA) +
geom_sf(data = clips[[6]], fill = demPal[4], alpha = 0.9,color = NA) +
## EEZ
geom_sf(lwd = 1, col = '#173028', fill = 'grey88',alpha = 0.2) +
## show major currents
# geom_polygon(data = shapefile_df,
#              aes(x = long, y = lat, group = group, fill = id),
#              fill = rep(currents.col,
#                         length(shapefile_df$id)/5), size = 0.2) +
# annotate("segment", x = x1, xend = x1end, y = y1, yend = y1,
#          colour = currents.col[1:4], size = 1.1) +
# annotate("text", x = x1+20, y = y1,
#          label =  c('Alaskan Current',
#                     'N. Pacific Current',
#                     'S. California Bight',
#                     'California Current')) +
## OM strata labels
# geom_label(data = data.frame(), aes( x = c(238, 233, 232, 225, 220, 200),
#   y = c(33, 40, 49, 52, 57, 53)),
#   label = list(c(1:6),
#                c(paste0('Subarea ',c("C1", "C2", "B1","B2","A2", "A1"))),
#              c("C1", "C2", "B1","B2","A2", "A1"))[[2]] ,
#   fill = rev(subareaPal),
#   color = 'black') +
## OM Stock labels
geom_label(data = data.frame(), aes( x = c(238, 233, 223,  200),
y = c(33, 48,  54, 53)),
label = list(c(1:5),
c(paste0('Stock ',c("R1", "R2", "R3","R4"))),
c("R1", "R2", "R3","R4"))[[2]] ,
fill = rev(demPal),
color = 'black') +
coord_sf(xlim = c(165, 245), ylim = c(26, 65)) +
labs(x ="",y="")
ggplot(data = regions) +
# kaplot::theme_solarized_mk(base_size = 16, light = FALSE) +
theme_classic(base_size = 14) +
## mgmt fills
# geom_sf(data = clips[[1]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = mgmtPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = mgmtPal[2], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = mgmtPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = mgmtPal[3], alpha = 0.9,color = NA) +
## show demography from growth paper
##R3
# geom_sf(data =   st_union(x=clips[[2]],y=clips[[3]])  ,
# fill = NA, lwd = 1.1,color = 'white', linetype = 'dashed') +
# ##r2
# geom_sf(data =   st_union(x=clips[[4]],y=clips[[5]])  ,
# fill = NA, lwd = 1.1,  color = 'white', linetype = 'dashed') +
## subarea fills
# geom_sf(data = clips[[1]], fill = subareaPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = subareaPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = subareaPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = subareaPal[4], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = subareaPal[5], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = subareaPal[6], alpha = 0.9,color = NA) +
## stock fills
geom_sf(data = clips[[1]], fill = demPal[1], alpha = 0.9, color = NA) +
geom_sf(data =  clips[[2]], fill = demPal[2], alpha = 0.9, color = NA) +
geom_sf(data = clips[[3]], fill = demPal[2], alpha = 0.9, color = NA) +
geom_sf(data = clips[[4]], fill = demPal[3], alpha = 0.9, color = NA ) +
geom_sf(data = clips[[5]], fill = demPal[3], alpha = 0.9, color = NA) +
geom_sf(data = clips[[6]], fill = demPal[4], alpha = 0.9,color = NA) +
## EEZ
geom_sf(lwd = 1, col = '#173028', fill = 'grey88',alpha = 0.2) +
## show major currents
# geom_polygon(data = shapefile_df,
#              aes(x = long, y = lat, group = group, fill = id),
#              fill = rep(currents.col,
#                         length(shapefile_df$id)/5), size = 0.2) +
# annotate("segment", x = x1, xend = x1end, y = y1, yend = y1,
#          colour = currents.col[1:4], size = 1.1) +
# annotate("text", x = x1+20, y = y1,
#          label =  c('Alaskan Current',
#                     'N. Pacific Current',
#                     'S. California Bight',
#                     'California Current')) +
## OM strata labels
# geom_label(data = data.frame(), aes( x = c(238, 233, 232, 225, 220, 200),
#   y = c(33, 40, 49, 52, 57, 53)),
#   label = list(c(1:6),
#                c(paste0('Subarea ',c("C1", "C2", "B1","B2","A2", "A1"))),
#              c("C1", "C2", "B1","B2","A2", "A1"))[[2]] ,
#   fill = rev(subareaPal),
#   color = 'black') +
## OM Stock labels
geom_label(data = data.frame(), aes( x = c(238, 233, 223,  200),
y = c(33, 48,  54, 53)),
label = list(c(1:5),
c(paste0('Stock ',c("R1", "R2", "R3","R4"))),
c("R1", "R2", "R3","R4"))[[1]] ,
fill = rev(demPal),
color = 'black') +
coord_sf(xlim = c(165, 245), ylim = c(26, 65)) +
labs(x ="",y="")
ggplot(data = regions) +
# kaplot::theme_solarized_mk(base_size = 16, light = FALSE) +
theme_classic(base_size = 14) +
## mgmt fills
# geom_sf(data = clips[[1]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = mgmtPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = mgmtPal[2], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = mgmtPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = mgmtPal[3], alpha = 0.9,color = NA) +
## show demography from growth paper
##R3
# geom_sf(data =   st_union(x=clips[[2]],y=clips[[3]])  ,
# fill = NA, lwd = 1.1,color = 'white', linetype = 'dashed') +
# ##r2
# geom_sf(data =   st_union(x=clips[[4]],y=clips[[5]])  ,
# fill = NA, lwd = 1.1,  color = 'white', linetype = 'dashed') +
## subarea fills
# geom_sf(data = clips[[1]], fill = subareaPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = subareaPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = subareaPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = subareaPal[4], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = subareaPal[5], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = subareaPal[6], alpha = 0.9,color = NA) +
## stock fills
geom_sf(data = clips[[1]], fill = demPal[1], alpha = 0.9, color = NA) +
geom_sf(data =  clips[[2]], fill = demPal[2], alpha = 0.9, color = NA) +
geom_sf(data = clips[[3]], fill = demPal[2], alpha = 0.9, color = NA) +
geom_sf(data = clips[[4]], fill = demPal[3], alpha = 0.9, color = NA ) +
geom_sf(data = clips[[5]], fill = demPal[3], alpha = 0.9, color = NA) +
geom_sf(data = clips[[6]], fill = demPal[4], alpha = 0.9,color = NA) +
## EEZ
geom_sf(lwd = 1, col = '#173028', fill = 'grey88',alpha = 0.2) +
## show major currents
# geom_polygon(data = shapefile_df,
#              aes(x = long, y = lat, group = group, fill = id),
#              fill = rep(currents.col,
#                         length(shapefile_df$id)/5), size = 0.2) +
# annotate("segment", x = x1, xend = x1end, y = y1, yend = y1,
#          colour = currents.col[1:4], size = 1.1) +
# annotate("text", x = x1+20, y = y1,
#          label =  c('Alaskan Current',
#                     'N. Pacific Current',
#                     'S. California Bight',
#                     'California Current')) +
## OM strata labels
# geom_label(data = data.frame(), aes( x = c(238, 233, 232, 225, 220, 200),
#   y = c(33, 40, 49, 52, 57, 53)),
#   label = list(c(1:6),
#                c(paste0('Subarea ',c("C1", "C2", "B1","B2","A2", "A1"))),
#              c("C1", "C2", "B1","B2","A2", "A1"))[[2]] ,
#   fill = rev(subareaPal),
#   color = 'black') +
## OM Stock labels
geom_label(data = data.frame(), aes( x = c(238, 233, 223,  200),
y = c(33, 48,  54, 53)),
label = list(c(1:4),
c(paste0('Stock ',c("R1", "R2", "R3","R4"))),
c("R1", "R2", "R3","R4"))[[1]] ,
fill = rev(demPal),
color = 'black') +
coord_sf(xlim = c(165, 245), ylim = c(26, 65)) +
labs(x ="",y="")
# Save
ggsave(here::here("figs", "map-EEZ_strata_stock_lab3.png"),
width = 22, height = 10)
# Save
ggsave(here::here("figs", "map-EEZ_stock_lab3.png"),
width = 22, height = 10)
ggplot(data = regions) +
# kaplot::theme_solarized_mk(base_size = 16, light = FALSE) +
theme_classic(base_size = 14) +
## mgmt fills
# geom_sf(data = clips[[1]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = mgmtPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = mgmtPal[2], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = mgmtPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = mgmtPal[3], alpha = 0.9,color = NA) +
## show demography from growth paper
##R3
# geom_sf(data =   st_union(x=clips[[2]],y=clips[[3]])  ,
# fill = NA, lwd = 1.1,color = 'white', linetype = 'dashed') +
# ##r2
# geom_sf(data =   st_union(x=clips[[4]],y=clips[[5]])  ,
# fill = NA, lwd = 1.1,  color = 'white', linetype = 'dashed') +
## subarea fills
geom_sf(data = clips[[1]], fill = subareaPal[1], alpha = 0.9, color = NA) +
geom_sf(data =  clips[[2]], fill = subareaPal[2], alpha = 0.9, color = NA) +
geom_sf(data = clips[[3]], fill = subareaPal[3], alpha = 0.9, color = NA) +
geom_sf(data = clips[[4]], fill = subareaPal[4], alpha = 0.9, color = NA ) +
geom_sf(data = clips[[5]], fill = subareaPal[5], alpha = 0.9, color = NA) +
geom_sf(data = clips[[6]], fill = subareaPal[6], alpha = 0.9,color = NA) +
## stock fills
# geom_sf(data = clips[[1]], fill = demPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = demPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = demPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = demPal[3], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = demPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = demPal[4], alpha = 0.9,color = NA) +
## EEZ
geom_sf(lwd = 1, col = '#173028', fill = 'grey88',alpha = 0.2) +
## show major currents
# geom_polygon(data = shapefile_df,
#              aes(x = long, y = lat, group = group, fill = id),
#              fill = rep(currents.col,
#                         length(shapefile_df$id)/5), size = 0.2) +
# annotate("segment", x = x1, xend = x1end, y = y1, yend = y1,
#          colour = currents.col[1:4], size = 1.1) +
# annotate("text", x = x1+20, y = y1,
#          label =  c('Alaskan Current',
#                     'N. Pacific Current',
#                     'S. California Bight',
#                     'California Current')) +
## OM strata labels
geom_label(data = data.frame(), aes( x = c(238, 233, 232, 225, 220, 200),
y = c(33, 40, 49, 52, 57, 53)),
label = list(c(1:6),
c(paste0('Subarea ',c("C1", "C2", "B1","B2","A2", "A1"))),
c("C1", "C2", "B1","B2","A2", "A1"))[[1]] ,
fill = rev(subareaPal),
color = 'black') +
## OM Stock labels
# geom_label(data = data.frame(), aes( x = c(238, 233, 223,  200),
#                                      y = c(33, 48,  54, 53)),
#            label = list(c(1:4),
#                         c(paste0('Stock ',c("R1", "R2", "R3","R4"))),
#                       c("R1", "R2", "R3","R4"))[[1]] ,
#            fill = rev(demPal),
#            color = 'black') +
coord_sf(xlim = c(165, 245), ylim = c(26, 65)) +
labs(x ="",y="")
# Save
ggsave(here::here("figs", "map-EEZ_strata_lab3.png"),
width = 22, height = 10)
ggplot(data = regions) +
# kaplot::theme_solarized_mk(base_size = 16, light = FALSE) +
theme_classic(base_size = 14) +
## mgmt fills
# geom_sf(data = clips[[1]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = mgmtPal[1], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = mgmtPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = mgmtPal[2], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = mgmtPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = mgmtPal[3], alpha = 0.9,color = NA) +
## show demography from growth paper
##R3
# geom_sf(data =   st_union(x=clips[[2]],y=clips[[3]])  ,
# fill = NA, lwd = 1.1,color = 'white', linetype = 'dashed') +
# ##r2
# geom_sf(data =   st_union(x=clips[[4]],y=clips[[5]])  ,
# fill = NA, lwd = 1.1,  color = 'white', linetype = 'dashed') +
## panmictic fill
geom_sf(data = clips[[1]], fill = 'grey44', alpha = 0.9, color = NA) +
geom_sf(data =  clips[[2]], fill = 'grey44', alpha = 0.9, color = NA) +
geom_sf(data = clips[[3]], fill = 'grey44', alpha = 0.9, color = NA) +
geom_sf(data = clips[[4]], fill = 'grey44', alpha = 0.9, color = NA ) +
geom_sf(data = clips[[5]], fill = 'grey44', alpha = 0.9, color = NA) +
geom_sf(data = clips[[6]], fill = 'grey44', alpha = 0.9,color = NA) +
## subarea fills
# geom_sf(data = clips[[1]], fill = subareaPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = subareaPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = subareaPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = subareaPal[4], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = subareaPal[5], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = subareaPal[6], alpha = 0.9,color = NA) +
## stock fills
# geom_sf(data = clips[[1]], fill = demPal[1], alpha = 0.9, color = NA) +
# geom_sf(data =  clips[[2]], fill = demPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[3]], fill = demPal[2], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[4]], fill = demPal[3], alpha = 0.9, color = NA ) +
# geom_sf(data = clips[[5]], fill = demPal[3], alpha = 0.9, color = NA) +
# geom_sf(data = clips[[6]], fill = demPal[4], alpha = 0.9,color = NA) +
## EEZ
geom_sf(lwd = 1, col = '#173028', fill = 'grey88',alpha = 0.2) +
## show major currents
# geom_polygon(data = shapefile_df,
#              aes(x = long, y = lat, group = group, fill = id),
#              fill = rep(currents.col,
#                         length(shapefile_df$id)/5), size = 0.2) +
# annotate("segment", x = x1, xend = x1end, y = y1, yend = y1,
#          colour = currents.col[1:4], size = 1.1) +
# annotate("text", x = x1+20, y = y1,
#          label =  c('Alaskan Current',
#                     'N. Pacific Current',
#                     'S. California Bight',
#                     'California Current')) +
## OM strata labels
# geom_label(data = data.frame(), aes( x = c(238, 233, 232, 225, 220, 200),
#   y = c(33, 40, 49, 52, 57, 53)),
#   label = list(c(1:6),
#                c(paste0('Subarea ',c("C1", "C2", "B1","B2","A2", "A1"))),
#              c("C1", "C2", "B1","B2","A2", "A1"))[[1]] ,
#   fill = rev(subareaPal),
#   color = 'black') +
## OM Stock labels
# geom_label(data = data.frame(), aes( x = c(238, 233, 223,  200),
#                                      y = c(33, 48,  54, 53)),
#            label = list(c(1:4),
#                         c(paste0('Stock ',c("R1", "R2", "R3","R4"))),
#                       c("R1", "R2", "R3","R4"))[[1]] ,
#            fill = rev(demPal),
#            color = 'black') +
coord_sf(xlim = c(165, 245), ylim = c(26, 65)) +
labs(x ="",y="")
# Save
ggsave(here::here("figs", "map-EEZ_panmictic.png"),
width = 22, height = 10)
